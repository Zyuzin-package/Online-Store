<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Statistics</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
            // var data = google.visualization.arrayToDataTable([
            //   getData("[[${visitStatsMap}]]")
            // ]);

            var options = {
                title: 'Company Performance',
                curveType: 'function',
                legend: { position: 'bottom' }
            };

            var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));

            chart.draw(getData("[[${visitStatsMap}]]"), options);
        }
        function getData(str) {
            str = str.substring(1);
            var num = 0;
            let arr = [];
            while (str.length>0) {
                var temp = str.split(',')[0];
                var length = temp.length;
                str = str.slice(length+1);
                var y = temp.split('-')[0];

                var m = temp.split('-')[1];
                var count = temp.split('=')[1];

                temp = temp.slice(9);
                var d = temp.split('T')[0];
                console.log(parseInt(count,10))
                arr[num] = [parseFloat(m),parseFloat(count)];

                num= num +1;

            }
            arr.pop();
            console.log(arr);
            return arr;
        }
    </script>
</head>
<body>
<div th:insert="~{fragments/menu :: #nav-menu}"></div>
<div th:insert="~{fragments/productsStatistics :: #products-statistic-menu}"></div>
<div id="curve_chart" style="width: 900px; height: 500px"></div>
<table border="1" align="center">
    <tr>
        <td colspan="2">
            Visit statistics
        </td>
    </tr>
    <tr th:each="v: ${visitStatsMap}">
        <td th:text="${v.key}"></td>
        <td th:text="${v.value}"></td>
    </tr>
</table>

<table border="1" align="center">
    <tr>
        <td colspan="2">
            Frequency add to cart statistics
        </td>
    </tr>
    <tr th:each="f: ${frequencyAddToCartStatsMap}">
        <td th:text="${f.key}"></td>
        <td th:text="${f.value}"></td>
    </tr>
</table>

<table border="1" align="center">
    <tr>
        <td colspan="3">
            Shopping frequency statistics
        </td>
    </tr>
    <tr th:each="b: ${buyStatsMap}">
        <td th:text="${b.key}"></td>
        <td th:text="${b.value}"></td>
    </tr>
</table>

</body>
</html>