<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Statistics</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

</head>
<body>
<div th:insert="~{fragments/menu :: #nav-menu}"></div>
<div th:insert="~{fragments/productsStatistics :: #products-statistic-menu}"></div>
<div id="linechart_material1" style="width: 900px; height: 500px"></div>
</body>
<script type="text/javascript">
    google.charts.load('current', {'packages': ['line']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
        let json2 = "[[${visitTest}]]";
        var data1 = getData(json2);



        var options1 = {
            chart: {
                title: 'Visit stats',
            },
            width: 900,
            height: 500,
            colors: "blue"
        };
        var chart1 = new google.charts.Line(document.getElementById('linechart_material1'));
        chart1.draw(data1, google.charts.Line.convertOptions(options1));
    }
    function getData(json){
        console.log(json)
        var temp2 = JSON.parse(json.replace(/&quot;/g, '"'));
        var data1 = new google.visualization.DataTable();
        console.log(temp2)

        let productJson = "[[${productsTitle}]]";
        var products = JSON.parse(productJson.replace(/&quot;/g, '"'));
        data1.addColumn('string', 'Date');

        for (let p in products) {
            data1.addColumn('number', products[p]);
        }
        console.log(data1)
        console.log("TEMP2: "+temp2)
        console.log("_______")
        let korka =[]
        for (var k in temp2) {
            let arr = [];
            //console.log(key + "|" + k + "|" + temp2[key][k]);
            arr.push(k);
            for (var t in temp2[k]){
                arr.push(temp2[k][t])
            }
            korka.push(arr);
            console.log(arr);
            data1.addRows(korka);
        }
        console.log(data1)
        return data1;
    }

</script>
</html>